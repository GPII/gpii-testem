"use strict";var cov_100rwh8e8t=function(){var path="/Users/duhrer/Source/rtf/gpii-testem/src/js/coverageReceiverMiddleware.js",hash="ffd248d905526c8fba6acfbeeea09452173f20ac",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/duhrer/Source/rtf/gpii-testem/src/js/coverageReceiverMiddleware.js",statementMap:{"0":{start:{line:3,column:12},end:{line:3,column:31}},"1":{start:{line:4,column:12},end:{line:4,column:43}},"2":{start:{line:6,column:0},end:{line:6,column:24}},"3":{start:{line:9,column:13},end:{line:9,column:26}},"4":{start:{line:10,column:13},end:{line:10,column:28}},"5":{start:{line:11,column:13},end:{line:11,column:30}},"6":{start:{line:13,column:0},end:{line:13,column:57}},"7":{start:{line:18,column:0},end:{line:31,column:2}},"8":{start:{line:19,column:4},end:{line:19,column:26}},"9":{start:{line:21,column:16},end:{line:25,column:88}},"10":{start:{line:27,column:4},end:{line:30,column:6}},"11":{start:{line:33,column:0},end:{line:38,column:2}},"12":{start:{line:34,column:4},end:{line:37,column:5}},"13":{start:{line:35,column:34},end:{line:35,column:84}},"14":{start:{line:36,column:8},end:{line:36,column:36}},"15":{start:{line:40,column:0},end:{line:61,column:2}},"16":{start:{line:41,column:30},end:{line:41,column:80}},"17":{start:{line:43,column:26},end:{line:43,column:46}},"18":{start:{line:45,column:23},end:{line:45,column:111}},"19":{start:{line:47,column:23},end:{line:47,column:65}},"20":{start:{line:48,column:23},end:{line:48,column:71}},"21":{start:{line:50,column:30},end:{line:50,column:174}},"22":{start:{line:51,column:30},end:{line:51,column:78}},"23":{start:{line:53,column:4},end:{line:60,column:7}},"24":{start:{line:54,column:8},end:{line:59,column:9}},"25":{start:{line:55,column:12},end:{line:55,column:72}},"26":{start:{line:58,column:12},end:{line:58,column:103}},"27":{start:{line:63,column:0},end:{line:79,column:3}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:18,column:40},end:{line:18,column:41}},loc:{start:{line:18,column:54},end:{line:31,column:1}},line:18},"1":{name:"(anonymous_1)",decl:{start:{line:33,column:47},end:{line:33,column:48}},loc:{start:{line:33,column:63},end:{line:38,column:1}},line:33},"2":{name:"(anonymous_2)",decl:{start:{line:40,column:47},end:{line:40,column:48}},loc:{start:{line:40,column:82},end:{line:61,column:1}},line:40},"3":{name:"(anonymous_3)",decl:{start:{line:53,column:109},end:{line:53,column:110}},loc:{start:{line:53,column:126},end:{line:60,column:5}},line:53}},branchMap:{"0":{loc:{start:{line:21,column:16},end:{line:25,column:88}},type:"binary-expr",locations:[{start:{line:21,column:16},end:{line:21,column:50}},{start:{line:22,column:8},end:{line:22,column:42}},{start:{line:23,column:8},end:{line:23,column:55}},{start:{line:24,column:8},end:{line:24,column:36}},{start:{line:25,column:8},end:{line:25,column:36}},{start:{line:25,column:40},end:{line:25,column:82}},{start:{line:25,column:86},end:{line:25,column:88}}],line:21},"1":{loc:{start:{line:28,column:14},end:{line:28,column:37}},type:"binary-expr",locations:[{start:{line:28,column:14},end:{line:28,column:24}},{start:{line:28,column:28},end:{line:28,column:37}}],line:28},"2":{loc:{start:{line:29,column:17},end:{line:29,column:34}},type:"binary-expr",locations:[{start:{line:29,column:17},end:{line:29,column:27}},{start:{line:29,column:31},end:{line:29,column:34}}],line:29},"3":{loc:{start:{line:34,column:4},end:{line:37,column:5}},type:"if",locations:[{start:{line:34,column:4},end:{line:37,column:5}},{start:{line:34,column:4},end:{line:37,column:5}}],line:34},"4":{loc:{start:{line:48,column:23},end:{line:48,column:71}},type:"cond-expr",locations:[{start:{line:48,column:34},end:{line:48,column:59}},{start:{line:48,column:62},end:{line:48,column:71}}],line:48},"5":{loc:{start:{line:54,column:8},end:{line:59,column:9}},type:"if",locations:[{start:{line:54,column:8},end:{line:59,column:9}},{start:{line:54,column:8},end:{line:59,column:9}}],line:54}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0,0,0,0,0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var fluid=(cov_100rwh8e8t.s[0]++,require("infusion"));var gpii=(cov_100rwh8e8t.s[1]++,fluid.registerNamespace("gpii"));cov_100rwh8e8t.s[2]++;require("gpii-express");var fs=(cov_100rwh8e8t.s[3]++,require("fs"));var path=(cov_100rwh8e8t.s[4]++,require("path"));var mkdirp=(cov_100rwh8e8t.s[5]++,require("mkdirp"));cov_100rwh8e8t.s[6]++;fluid.registerNamespace("gpii.testem.coverage.receiver");cov_100rwh8e8t.s[7]++;gpii.testem.coverage.receiver.uaMatch=function(ua){cov_100rwh8e8t.f[0]++;cov_100rwh8e8t.s[8]++;ua=ua.toLowerCase();var match=(cov_100rwh8e8t.s[9]++,(cov_100rwh8e8t.b[0][0]++,/(chrome)[ \/]([\w.]+)/.exec(ua))||(cov_100rwh8e8t.b[0][1]++,/(webkit)[ \/]([\w.]+)/.exec(ua))||(cov_100rwh8e8t.b[0][2]++,/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua))||(cov_100rwh8e8t.b[0][3]++,/(msie) ([\w.]+)/.exec(ua))||(cov_100rwh8e8t.b[0][4]++,ua.indexOf("compatible")<0)&&(cov_100rwh8e8t.b[0][5]++,/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua))||(cov_100rwh8e8t.b[0][6]++,[]));cov_100rwh8e8t.s[10]++;return{name:(cov_100rwh8e8t.b[1][0]++,match[1])||(cov_100rwh8e8t.b[1][1]++,"unknown"),version:(cov_100rwh8e8t.b[2][0]++,match[2])||(cov_100rwh8e8t.b[2][1]++,"0")};};cov_100rwh8e8t.s[11]++;gpii.testem.coverage.receiver.initMiddleware=function(that){cov_100rwh8e8t.f[1]++;cov_100rwh8e8t.s[12]++;if(that.options.coverageDir){cov_100rwh8e8t.b[3][0]++;var resolvedCoverageDir=(cov_100rwh8e8t.s[13]++,fluid.module.resolvePath(that.options.coverageDir));cov_100rwh8e8t.s[14]++;mkdirp(resolvedCoverageDir);}else{cov_100rwh8e8t.b[3][1]++;}};cov_100rwh8e8t.s[15]++;gpii.testem.coverage.receiver.middlewareImpl=function(that,request,response){cov_100rwh8e8t.f[2]++;var resolvedCoverageDir=(cov_100rwh8e8t.s[16]++,fluid.module.resolvePath(that.options.coverageDir));var coveragePayload=(cov_100rwh8e8t.s[17]++,request.body.payload);var browser=(cov_100rwh8e8t.s[18]++,gpii.testem.coverage.receiver.uaMatch(fluid.get(coveragePayload,"navigator.userAgent")));var testPath=(cov_100rwh8e8t.s[19]++,fluid.get(coveragePayload.document,"URL"));var testFilename=(cov_100rwh8e8t.s[20]++,testPath?(cov_100rwh8e8t.b[4][0]++,testPath.split("/").pop()):(cov_100rwh8e8t.b[4][1]++,"unknown"));var coverageFilename=(cov_100rwh8e8t.s[21]++,["coverage","-",browser.name,"-",browser.version,"-",testFilename,"-",that.id,"-",Math.round(Math.random()*10000),".json"].join(""));var coverageOutputPath=(cov_100rwh8e8t.s[22]++,path.join(resolvedCoverageDir,coverageFilename));cov_100rwh8e8t.s[23]++;fs.writeFile(coverageOutputPath,JSON.stringify(coveragePayload.coverage,null,2),{encoding:"utf8"},function(error){cov_100rwh8e8t.f[3]++;cov_100rwh8e8t.s[24]++;if(error){cov_100rwh8e8t.b[5][0]++;cov_100rwh8e8t.s[25]++;response.status(500).send({isError:true,message:error});}else{cov_100rwh8e8t.b[5][1]++;cov_100rwh8e8t.s[26]++;response.status(200).send({message:"You have successfully saved your coverage report."});}});};cov_100rwh8e8t.s[27]++;fluid.defaults("gpii.testem.coverage.receiver.middleware",{gradeNames:["gpii.express.middleware"],path:"/",method:["put","post"],invokers:{middleware:{funcName:"gpii.testem.coverage.receiver.middlewareImpl",args:["{that}","{arguments}.0","{arguments}.1","{arguments}.2"]}},listeners:{"onCreate.init":{funcName:"gpii.testem.coverage.receiver.initMiddleware",args:["{that}"]}}});